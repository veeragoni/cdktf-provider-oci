# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".

name: generate-bindings
on:
  push:
    branches:
      - main
    paths:
      - .projenrc.ts
      - provider-config.json
  workflow_dispatch:
    inputs:
      provider_version:
        description: OCI Provider version (e.g., 6.0)
        required: false
        type: string
jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install dependencies
        run: yarn install --frozen-lockfile
      - name: Generate provider bindings
        run: "

          \        if [ -n \"${{ github.event.inputs.providerVersion }}\" ]; then

          \          PROVIDER_VERSION=\"${{ github.event.inputs.providerVersion }}\"

          \        else

          \          PROVIDER_VERSION=$(grep -oP '\"terraformProvider\":\\s*\"oracle/oci@~>\\s*\\K[0-9]+\\.[0-9]+' .projenrc.ts || echo \"6.0\")

          \        fi


          \        echo \"Generating bindings for OCI provider version: $PROVIDER_VERSION\"

          \        npx cdktf-cli@latest get --language typescript --provider \"oracle/oci@~> $PROVIDER_VERSION\"

          \      "
      - name: Build project
        run: npx projen build
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: provider-bindings
          path: |-
            lib/
            dist/
            .gen/
